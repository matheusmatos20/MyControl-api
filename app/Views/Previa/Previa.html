<!DOCTYPE html> 
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pr√©via Mensal</title>
  <link rel="stylesheet" href="Previa.css" />
  <link rel="stylesheet" href="../Menu/Menu.css">
</head>
<body>
  <div id="menu-container"></div>

  <!-- üîπ Conte√∫do principal -->
  <div id="content" class="content">
    <main class="container">
      <h1>Pr√©via Mensal</h1>

      <div class="filtros">
        <label for="filterCompetencia">Compet√™ncia:</label>
        <input type="month" id="filterCompetencia" />
        <button type="button" id="btnAplicarFiltro">Aplicar</button>
        <button type="button" id="btnLimparFiltro" class="secondary">Limpar</button>
      </div>

      <!-- Indicadores -->
      <div class="indicadores">
        <div class="card"><strong>Ticket M√©dio:</strong> <span id="lblValorTicket">--</span></div>
        <div class="card"><strong>Valor Bruto:</strong> <span id="lblValorBruto">--</span></div>
        <div class="card"><strong>Descontos:</strong> <span id="lblTotalDescont">--</span></div>
        <div class="card"><strong>Valor L√≠quido:</strong> <span id="lblTotalLiq">--</span></div>
        <div class="card"><strong>% Lucro:</strong> <span id="lblPerc">--</span></div>
      </div>

      <!-- Tabela D√©bitos -->
      <div class="tabela-wrapper">
        <h2>D√©bitos (Pagamentos)</h2>
        <table id="dgvDebito">
          <thead>
            <tr>
              <th>ID</th>
              <th>Descri√ß√£o</th>
              <th>Fornecedor</th>
              <th>Vencimento</th>
              <th>Forma Pagamento</th>
              <th>Valor</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="actions">
          <button id="btnBaixarPagamento" class="hidden">Baixar</button>
          <button id="btnExcluirPagamento" class="hidden danger">Excluir</button>
        </div>
      </div>

      <!-- Tabela Cr√©ditos -->
      <div class="tabela-wrapper">
        <h2>Cr√©ditos (Servi√ßos)</h2>
        <table id="dgvCredito">
          <thead>
            <tr>
              <th>ID</th>
              <th>Data</th>
              <th>Cliente</th>
              <th>Servi√ßo</th>
              <th>Valor</th>
              <th>Desconto</th>
              <th>L√≠quido</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="actions">
          <button id="btnExcluirCredito" class="hidden danger">Excluir Cr√©dito</button>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script src="../auth.js"></script> <!-- Fun√ß√µes de auth (encrypt/decrypt/valida√ß√£o de token) -->
  <!-- Scripts -->
  <script src="Previa.js"></script>
  <script src="../Menu/Menu.js"></script>
  <script>
    // Carregar menu
    fetch('../Menu/Menu.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('menu-container').innerHTML = html;
      })
      .catch(error => console.error('Erro ao carregar o menu:', error));

    // üîπ Ajustar responsividade ao recolher o menu
    document.addEventListener("DOMContentLoaded", () => {
      const observer = new MutationObserver(() => {
        const menu = document.querySelector(".menu");
        const content = document.getElementById("content");
        if (menu && content) {
          content.classList.toggle("recolhido", menu.classList.contains("recolhido"));
        }
      });

      const interval = setInterval(() => {
        const menu = document.querySelector(".menu");
        if (menu) {
          observer.observe(menu, { attributes: true, attributeFilter: ["class"] });
          clearInterval(interval);
        }
      }, 100);
    });
  </script>
</body>
</html>
